<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="utf-8">
    <title>FIR</title>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="bootstrap.js"></script>
    <script type="text/javascript" src="js/web3/dist/web3.min.js"></script>
    <script type="text/javascript" src="js/web3-config.js"></script>
    <script type="text/javascript" src="./artifacts/fir.js"></script>
    <script>
      //-------------Get Address--------------
async function wallet() {
let defaultAccount=0;

defaultAccount = await web3.eth.getAccounts()
    .then(
        accounts => accounts[0]
        );

const address_data =  Promise.resolve(defaultAccount);
 address_data.then(value => {

  if(value!=undefined)
  {
     console.log(value);
     setCookie("address", value, 365);
     document.getElementById("wallet_address").innerHTML =value;
     
  }
  else{
    console.log("Please Connect to Wallet and Refresh");
    document.getElementById("address").innerHTML = "Please Connect to Wallet and Refresh.";
  }

}).catch(err => {
 
});

}

wallet();
//-------------Get Address--------------
    </script>
    

<!-- ************** Jquery active link styling *******************  -->

    <style media="screen">
/*------------------- LOADER ---------------------*/
.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #00218d;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/*------------------- LOADER ---------------------*/

      .active{

        border-bottom: 1.5px solid white;
        border-radius: 5%;
      }

      button{
        margin-right: 3.5% !important;
        color: #f7f8f3 !important;
      background-color: #281859 !important;
      }

    </style>


    <script type="application/javascript">
    $(document).ready(function(){
      $('a').click(function(){
        $('a').removeClass("active");
        $(this).addClass("active");
      });

    });

    </script>
    
    
        <script type="text/javascript">
      function yscroll(){
        var image = document.getElementById('image');
        var headr = document.getElementById('topheader');
        var hd = document.querySelector("h1");
        var h = document.getElementById('h');
        var g =document.getElementById('g');
        ypos=window.pageYOffset;
        if (ypos>120) {
          image.style.display="none";
          headr.style.height="85px";
           h.id='g';
        } else if(ypos<=119) {
          image.style.display="block";
          headr.style.height='auto';
          g.id='h';

        }

      }
      window.addEventListener("scroll",yscroll);

    </script>


<!-- ****************** file linking *************************************-->
    <link rel="stylesheet" href="bootstrap.css">
    <link rel="stylesheet" href="lodgestyle.css">
    <link rel="stylesheet" href="fontawesome/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  </head>

  <body>

    <!-- ****************** complete header *************************************-->

<div class="sticky-top">
  <!-- ****************** top header section *************************************-->

<section id="topheader">
      <div class="container">
        <div class="row">
        <header id="headr">
          <div class="col-xs-6 col-sm-3 col-md-2 col-lg-1" >
            <img id="image" src="img/thinksprout.png" alt="" class="" width="110px" height="70px">
              </div>
              <div class="col-xs-6 col-sm-9 col-md-10 col-lg-11">
                <h1 id="h" class="text-center heading text-responsive">F.I.R portal, MCOE police</h1><h5 id="wallet_address" class="text-center heading text-responsive">Loading..!!</h5>
              </div>
              </header>


            </div>

        </div>

</section>

<!-- ****************** navbar section *************************************-->

<section id="nav-bar">

<div class="container-fluid" >
<nav class="navbar navbar-expand-lg ">
  <a class="navbar-brand " href="#"></a>
  <button class="navbar-toggler mr-auto navbar-dark" type="button" data-toggle="collapse" data-target="#navbarNav"  aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class=""><i class="fas fa-bars fa-1x" style="color:#f7f8f3;"></i></span>
  </button>


  <div class="collapse navbar-collapse" id="navbarNav">
    <div class="navbar-nav ml-auto mr-auto">
      <a class="nav-item nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
      <a class="nav-item nav-link" href="reg_police.html">Onboard Police</a>
      <a class="nav-item nav-link" href="lodge.html">Lodge Complaint</a>
      <a class="nav-item nav-link " href="view.html">View Complaint</a>
      <a class="nav-item nav-link active" href="police-kyc.html">Police KYC</a>
    </div>
  </div>
</nav>

</div>
</section>

</div>

<div class="modal fade" id="model_loader">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
  
      <div class="modal-header">
       
    </div>
        <div class="modal-body">
          <div class="text-center" id="confirm">
          <img src="img/check.png" class="img-circle" style="width:100px; height:100px;" alt="">
          <p>Transaction Successful</p>
        </div>
        <div class="text-center" id="reject">
          <img src="img/cancel.png" class="img-circle" style="width:100px; height:100px;" alt="">
          <p>Transaction Failed</p>
        </div>
  <center>
        <div class="loader" id="preloader"></div>
      </center>
        </div>
  
  
  
    </div>
  
  </div>
  
  </div>

<div class="container border">

<div class="">
<form class="" action="" method="post">

  <table class="table">

    <colgroup>
    		<col class="one"/>
    		<col class="two"/>
    		<col class="three"/>
    		<col class="four"/>
    	</colgroup>

    <thead>
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

        <tr align="left" class="titles h5" height="30">
          <th colspan="4" style="color: #281859;">Police KYC</th>
        </tr>
        </div>
    </div>
        <!--  ********************************* row 1 validation ********************************************-->

        <div class="row">
          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

        <tr>

         <td colspan="4" align="left" style="color: #281859;padding:2% 1.3%;font-size: 1.25em;font-weight: normal;">
        <font style="margin-bottom:2%;" color="red">Please Enter The Police Address</font><br>
        <b>Note:</b> Parameters marked with a <font color="red">*</font> are mandatory

       </td>


        </td>
        </tr>
      </div>
      </div>


    </thead>

    <tbody>

      <!--  ********************************* row 1 District name********************************************-->
    <div class="row">
    <tr>
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

      <td colspan="1">
        <label for="FirstComplainantName">Police Address
          <font color="RED">*</font>

        </label>
      </td>
    </div>
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

      <td colspan="21"><input placeholder="0x1cb404e7461Ed016F305a2a8E7140dA9abbddbb2" style=""  type="text" name="police_address" id="police_address" style="padding:6px;  border:1px solid #281859;" maxlength="100" value="" class="" onchange="" onblur=""></td>
    </div>
    </tr>
  </div>


    <!--  ********************************* row 2 ********************************************-->
    
    <!--  ********************************* row 3  ********************************************-->

    









    

    
  

    


<!--  ********************************* row 7 ********************************************-->

<tr>
<td colspan="4" align="center">
  <button type="button" onclick="get_police_data()" name="button">Get Details</button>
  <button type="reset" value="Reset" name="button">Reset</button></td>
 
</tr>

<div id="submit-data">



<div class="row">
  <tr>
    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

    <td colspan="1">
      <label for="FirstComplainantName" id="name"></label>
    </td>
    
  </div>
  
  </tr>
</div>



<div class="row">
  <tr>
    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

    <td colspan="1">
      <label for="FirstComplainantName" id="gender"></label>
    </td>
    
  </div>
  
  </tr>
</div>

<div class="row">
  <tr>
    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

    <td colspan="1">
      <label for="FirstComplainantName" id="age"></label>
    </td>
    
  </div>
  
  </tr>
</div>


<div class="row">
  <tr>
    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

    <td colspan="1">
      <label for="FirstComplainantName" id="postal_address"></label>
    </td>
    
  </div>
  
  </tr>
</div>


</div>


        </tbody>

  </table>
  

</form>



<div class="container border">

<div class="" id="only_admin">
<form class="" action="" method="post">

  <table class="table">

    <colgroup>
    		<col class="one"/>
    		<col class="two"/>
    		<col class="three"/>
    		<col class="four"/>
    	</colgroup>

    <thead>
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

        <tr align="left" class="titles h5" height="30">
          <th colspan="4" style="color: #281859;">Update Status</th>
        </tr>
        </div>
    </div>
        <!--  ********************************* row 1 validation ********************************************-->




    </thead>

    <tbody>

      <!--  ********************************* row 1 District name********************************************-->
    <div class="row">
    <tr>
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

      <td colspan="1">
        <label for="FirstComplainantName">Police ID
          <font color="RED">*</font>

        </label>
      </td>
    </div>
      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

      <td colspan="3"><input placeholder="Police ID" style=""  type="text" name="police_id_update" id="police_id_update" style="padding:6px;  border:1px solid #281859;" maxlength="100" value="" class="" onchange="" onblur="" readonly></td>
    </div>
    </tr>
  </div>


  </tr>

</div>










    


      

  

    


<!--  ********************************* row 7 ********************************************-->

<tr>
<td colspan="4" align="center">
  <button type="button" onclick="create_kyc()" name="button" data-target="#model_loader" data-toggle="modal">Create KYC</button>
  
 
</tr>





        </tbody>

  </table>
  
  <h7 id="ref_id" class="text-center heading text-responsive"></h7>
</form>
</div>




</div>

</div>











<footer>
  <div class="container-fluid">


<section id="foot">
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

<p class="text-center"> <br> &copyCOPYRIGHT 2022 THINKSPROUT VENTURES LLP - ALL RIGHTS RESERVED <br></p>
</div>

</div>
</section>

</div>
</footer>

<script>
var only_admin = document.getElementById("only_admin");
only_admin.style.display = "none";

async function get_police_data()
{

  const fir = new web3.eth.Contract(firAbi, firAddress);

  

  var _address = getCookie("address");
  var police_id = document.getElementById("police_address").value;
console.log("Police Address: ",police_id);
  fir.methods.getPoliceDetails(police_id).call({
                from: _address,
             
            })
            .then(
                (data1)=>{
                  document.getElementById("police_id_update").value = police_id;
              document.getElementById("name").innerHTML = "Name: "+data1[1];
              document.getElementById("gender").innerHTML = "Designation: "+data1[2];
              document.getElementById("age").innerHTML = "Police Station: "+data1[3];
              document.getElementById("postal_address").innerHTML = "KYC Status: "+data1[4];

            }
            );
            
            
            const fir_owner = await fir.methods.getOwner().call();

            if(_address==fir_owner)
            {
                only_admin.style.display = "block";
            }

            
}








async function create_kyc()
{

  const fir = new web3.eth.Contract(firAbi, firAddress);



  var _address = getCookie("address");

  var reject = document.getElementById("reject");
   var confirm = document.getElementById("confirm");
   var preloader = document.getElementById("preloader");
   confirm.style.display = "none";
   reject.style.display = "none";


   var police_id_update = document.getElementById("police_id_update").value;
   
  


   const options = {
        from: _address,
    };

    fir
        .methods.createKYC(police_id_update).send(options)
        .on("receipt",
            function (receipt) {
                
            
               
                preloader.style.display = "none";
                confirm.style.display = "block";
              
                
                //window.location.reload();
            })
            .on("error",
                    function (error, receipt) {
                        console.log(error);
                        preloader.style.display = "none";
                        reject.style.display = "block";
                       // window.location.reload();
                        console.log(error);
                    }
            ).then(console.log("Transaction-Capture"));

}
</script>

  </body>
</html>
